<!DOCTYPE html>
<html>
<head>
    <title>üìç –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        body, html { margin: 0; height: 100%; }
        #map { height: 100vh; }
        .info {
            position: fixed; top: 10px; left: 10px;
            background: white; padding: 10px; border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.2); z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="info">
        <h3>üìç –ü—Ä–æ—Å–º–æ—Ç—Ä –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</h3>
        <p id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
    </div>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ‚ö†Ô∏è –¢–ï –ñ–ï –ö–õ–Æ–ß–ò, –ß–¢–û –ò –í index.html
        const supabase = window.supabase.createClient(
            'https://–í–ê–®-ID.supabase.co',
            '–í–ê–®-ANON-KEY'
        );
        
        let map = L.map('map').setView([55.75, 37.61], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
        
        async function loadLocation() {
            const urlParams = new URLSearchParams(window.location.search);
            const shareId = urlParams.get('id') || urlParams.get('view');
            
            if (!shareId) {
                document.getElementById('status').textContent = '‚ùå –ù–µ—Ç ID –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞';
                return;
            }
            
            const { data } = await supabase
                .from('locations')
                .select('*')
                .eq('share_id', shareId)
                .order('updated_at', { ascending: false })
                .limit(1);
            
            if (data && data[0]) {
                const loc = data[0];
                L.marker([loc.latitude, loc.longitude])
                    .addTo(map)
                    .bindPopup(`
                        <b>üìç –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</b><br>
                        –í—Ä–µ–º—è: ${new Date(loc.updated_at).toLocaleString()}<br>
                        <small>–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫</small>
                    `)
                    .openPopup();
                
                map.setView([loc.latitude, loc.longitude], 15);
                document.getElementById('status').innerHTML = 
                    ‚úÖ –ê–∫—Ç–∏–≤–Ω–æ ‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${new Date(loc.updated_at).toLocaleTimeString()};
                
                // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
                setInterval(loadLocation, 5000);
            } else {
                document.getElementById('status').textContent = '‚ùå –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ';
            }
        }
        
        loadLocation();
    </script>
</body>
</html>
